//Author: Ruan van Maarleveld
//Description: Enables AngularJS projects to perform LiveReload and HotSwap
!function(){var e;angular.module("LiveReload",[],[function(){(e=new WebSocket("ws://localhost:4137/lr")).onopen=function(o){e.send(window.location.hostname),console.log("LiveReload started...")},e.onerror=function(e){console.error("LiveReload Stopped: "+e)},e.onclose=function(e){console.error("LiveReload no longer running...")},e.onmessage=function(e){(e.data.indexOf("Reload|")>-1||e.data.indexOf("HotSwap")>-1)&&(console.log("Reloading..."),location.reload())}}]),angular.module("LiveReload").service("LiveReloadHotSwap",["$compile","$templateRequest","$templateCache","$sce","$timeout","$injector",function(o,n,t,a,l,i){var r=null;return i.has("$uibModalStack")&&(r=i.get("$uibModalStack")),function(o,n,t,a,l,i){var r,d=!1,c={};return this.Disable=function(){e||(e.onmessage=function(e){(e.data.indexOf("Reload|")>-1||e.data.indexOf("HotSwap")>-1)&&(console.log("Reloading..."),location.reload())})},this.Enable=function(o){if(e){if(!o)throw new Error("Please pass your $scope to enable HotSwap!");r=o,e.onmessage=function(e){if(e.data.indexOf("Reload|")>-1)console.log("Reloading..."),location.reload();else if(e.data.indexOf("HotSwap")>-1&&!d){d=!0;var o=e.data.split("|")[1];o.endsWith("html")?c.CompileAndHotSwap(o):c.HotSwapCSS(o)}}}},c.getModalHeaderElement=function(e){for(var o,n=0;n<e.length;n++)if(e[n].className&&e[n].className.indexOf("modal-header")>-1){o=e[n];break}return o},c.CompileAndHotSwap=function(e){var l=t.get(e);if(l){var u=document.querySelector("ng-include[src=\"'"+e+"'\"]");if(u||(u=document.querySelector("div[ng-include=\"'"+e+"'\"]")),u){t.remove(e);var s=a.getTrustedResourceUrl(e);n(s).then(function(n){t.put(e,n),u.innerHTML=n,o(u)(r),d=!1})}else if(l.indexOf("modal-header")>-1){var p=angular.element(l),f=c.getModalHeaderElement(p);if(i&&f&&f.getAttribute("id")){var g=!1,S=i.getTop();if(S){var m=S.value.modalDomEl[0].children[0].children[0],w=c.getModalHeaderElement(m.children);if(w.getAttribute("id")&&w.getAttribute("id")===f.getAttribute("id")){g=!0,t.remove(e);var v=a.getTrustedResourceUrl(e);n(v).then(function(n){t.put(e,n),m.innerHTML=n,o(m)(S.value.modalScope),d=!1})}}g||(console.warn("Could not find the correct Open Modal. Skipping HotSwap..."),location.reload())}else i?(console.warn("No ID attribute found for modal. Skipping HotSwap..."),location.reload()):(console.warn("Inject ui.bootstrap into you app to HotSwap Modals (See: https://angular-ui.github.io/bootstrap/). Skipping HotSwap..."),location.reload())}else console.warn("Could not find DOM Element... Skipping HotSwap..."),location.reload()}else console.warn("Could not find template in cache... Skipping HotSwap..."),location.reload()},c.HotSwapCSS=function(e){var o=document.querySelector('LINK[href="'+e+'"]');if(o){var n=o.parentElement;n.removeChild(o),l(function(){n.appendChild(o),d=!1})}else console.warn("Could not find link in HEAD Tag... Skipping HotSwap..."),location.reload()},this}(o,n,t,a,l,r)}])}();